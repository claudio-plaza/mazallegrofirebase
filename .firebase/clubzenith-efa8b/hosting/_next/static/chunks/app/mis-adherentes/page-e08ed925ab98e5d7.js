(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3907],{43882:function(e,r,t){Promise.resolve().then(t.bind(t,89487))},89487:function(e,r,t){"use strict";t.d(r,{GestionAdherentesSocio:function(){return X}});var n=t(57437),o=t(2265),a=t(39343),i=t(31014),s=t(64451),l=t(89733),c=t(48185),d=t(93363),u=t(77209),m=t(86763),h=t(67048),x=t(92033),f=t(21812),p=t(92940),j=t(71935),g=t(11240),N=t(87385),v=t(94499),b=t(22023),y=t(22584),E=t(10883),w=t(96273),I=t(29973),D=t(79055),A=t(26912),C=t(97e3),P=t(80624),S=t(93191),F=t(40932),z=t(25524),O=t(66648);function X(){var e;let{toast:r}=(0,m.pm)(),{loggedInUserNumeroSocio:t,isLoading:X}=(0,h.a)(),[Z,L]=(0,o.useState)(""),R=(0,S.NL)(),{data:T,isLoading:M}=(0,F.a)({queryKey:["socio",t],queryFn:()=>(0,A.g1)(t),enabled:!!t&&!X}),{mutate:k,isPending:G}=(0,z.D)({mutationFn:e=>(0,A.uL)(e),onError:e=>{r({title:"Error",description:"No se pudo completar la operaci\xf3n: ".concat(e.message),variant:"destructive"})}});(0,o.useEffect)(()=>{let e=new Date;L((0,C.WU)(e,"yyyy-MM-dd"))},[]);let _=(0,a.cI)({resolver:(0,i.F)(s.S),mode:"onBlur",defaultValues:{nombre:"",apellido:"",dni:"",fechaNacimiento:new Date,empresa:"",telefono:"",direccion:"",email:"",fotoDniFrente:null,fotoDniDorso:null,fotoPerfil:null,fotoCarnet:null}}),W=async e=>{if(!T){r({title:"Error",description:"No se pudo cargar la informaci\xf3n del socio.",variant:"destructive"});return}let n=async(e,r)=>e instanceof FileList&&e.length>0?(0,A.cT)(e[0],"socios/".concat(T.id,"/").concat(r)):null,o=(0,x.Ox)(),a={id:o,nombre:e.nombre,apellido:e.apellido,dni:e.dni,empresa:e.empresa,telefono:e.telefono,direccion:e.direccion,email:e.email,fechaNacimiento:(0,C.WU)(e.fechaNacimiento,"yyyy-MM-dd"),fotoDniFrente:await n(e.fotoDniFrente,"adherentes/".concat(o,"_dniFrente.jpg")),fotoDniDorso:await n(e.fotoDniDorso,"adherentes/".concat(o,"_dniDorso.jpg")),fotoPerfil:await n(e.fotoPerfil,"adherentes/".concat(o,"_perfil.jpg")),fotoCarnet:await n(e.fotoCarnet,"adherentes/".concat(o,"_carnet.jpg")),estadoAdherente:s.D1.INACTIVO,estadoSolicitud:s.rX.PENDIENTE,aptoMedico:{valido:!1,razonInvalidez:"Pendiente de revisi\xf3n m\xe9dica inicial"}},i=[...T.adherentes||[],a];k({...T,adherentes:i},{onSuccess:()=>{R.invalidateQueries({queryKey:["socio",t]}),r({title:"Solicitud Enviada",description:"La solicitud para agregar a ".concat(e.nombre," ").concat(e.apellido," como adherente ha sido enviada.")}),_.reset()},onError:e=>{r({title:"Error",description:"No se pudo enviar la solicitud para el adherente: ".concat(e.message),variant:"destructive"})}})},J=async e=>{if(!e||!T||!T.adherentes)return;let n=T.adherentes.find(r=>r.id===e);if(!n)return;let o=T.adherentes.map(r=>r.id===e?{...r,estadoSolicitud:s.rX.PENDIENTE_ELIMINACION,motivoRechazo:"Solicitud de eliminaci\xf3n por el socio"}:r);k({...T,adherentes:o},{onSuccess:()=>{R.invalidateQueries({queryKey:["socio",t]}),r({title:"Solicitud de Eliminaci\xf3n Enviada",description:"Se ha solicitado la eliminaci\xf3n de ".concat(n.nombre,". Un administrador revisar\xe1 la solicitud.")})},onError:e=>{r({title:"Error",description:"No se pudo enviar la solicitud de eliminaci\xf3n: ".concat(e.message),variant:"destructive"})}})};if(M||X)return(0,n.jsx)("p",{className:"text-center py-10",children:"Cargando informaci\xf3n de adherentes..."});if(!T)return(0,n.jsxs)(c.Zb,{className:"w-full max-w-lg mx-auto text-center py-10",children:[(0,n.jsx)(c.Ol,{children:(0,n.jsx)(c.ll,{children:"Error"})}),(0,n.jsx)(c.aY,{children:(0,n.jsx)("p",{children:"No se pudo cargar la informaci\xf3n del socio. Por favor, recargue o contacte a soporte."})})]});let U=e=>{var r;return(null===(r=T.adherentes)||void 0===r?void 0:r.filter(r=>r.estadoSolicitud===e&&e!==s.rX.PENDIENTE_ELIMINACION))||[]},V=(null===(e=T.adherentes)||void 0===e?void 0:e.filter(e=>e.estadoSolicitud===s.rX.PENDIENTE_ELIMINACION))||[],q=e=>{if(e.estadoSolicitud===s.rX.PENDIENTE_ELIMINACION)return(0,n.jsxs)(D.C,{variant:"destructive",className:"bg-orange-600 hover:bg-orange-700",children:[(0,n.jsx)(f.Z,{className:"mr-1.5 h-3 w-3"})," Eliminaci\xf3n Pendiente"]});switch(e.estadoSolicitud){case s.rX.PENDIENTE:return(0,n.jsxs)(D.C,{variant:"outline",className:"border-yellow-500 text-yellow-600",children:[(0,n.jsx)(f.Z,{className:"mr-1.5 h-3 w-3"})," Pendiente Aprobaci\xf3n"]});case s.rX.APROBADO:return(0,n.jsxs)(D.C,{className:"".concat(e.estadoAdherente===s.D1.ACTIVO?"bg-green-500 hover:bg-green-600":"bg-slate-500 hover:bg-slate-600"),children:[(0,n.jsx)(p.Z,{className:"mr-1.5 h-3 w-3"})," ",e.estadoAdherente]});case s.rX.RECHAZADO:return(0,n.jsxs)(D.C,{variant:"destructive",children:[(0,n.jsx)(j.Z,{className:"mr-1.5 h-3 w-3"})," Rechazado"]});default:return(0,n.jsx)(D.C,{variant:"secondary",children:"Desconocido"})}};return(0,n.jsx)("div",{className:"space-y-8",children:(0,n.jsxs)(c.Zb,{className:"w-full max-w-3xl mx-auto shadow-xl",children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsxs)(c.ll,{className:"text-2xl flex items-center",children:[(0,n.jsx)(g.Z,{className:"mr-3 h-7 w-7 text-primary"}),"Mis Adherentes"]}),(0,n.jsx)(c.SZ,{children:"Aqu\xed puedes proponer nuevos adherentes para tu cuenta (ej. amigos). Las solicitudes ser\xe1n revisadas por administraci\xf3n. El adherente tambi\xe9n deber\xe1 completar su revisi\xf3n m\xe9dica."})]}),(0,n.jsxs)(c.aY,{children:[(0,n.jsx)(a.RV,{..._,children:(0,n.jsxs)("form",{onSubmit:_.handleSubmit(W),className:"space-y-6 p-4 border rounded-md bg-background mb-8",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-primary border-b pb-2 mb-4",children:"Proponer Nuevo Adherente"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[(0,n.jsx)(d.Wi,{control:_.control,name:"nombre",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[" ",(0,n.jsx)(d.lX,{children:"Nombre"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{placeholder:"Nombre del adherente",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"apellido",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[" ",(0,n.jsx)(d.lX,{children:"Apellido"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{placeholder:"Apellido del adherente",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"dni",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[" ",(0,n.jsx)(d.lX,{children:"DNI"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{type:"number",placeholder:"DNI (sin puntos)",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"fechaNacimiento",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[(0,n.jsx)(d.lX,{children:"Fecha de Nacimiento"}),(0,n.jsx)(d.NI,{children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(N.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),(0,n.jsx)(u.I,{type:"date",value:r.value?(0,C.WU)(new Date(r.value),"yyyy-MM-dd"):"",onChange:e=>r.onChange(e.target.value?(0,P.D)(e.target.value):null),max:Z,min:"1900-01-01",className:"w-full pl-10",disabled:!Z})]})}),(0,n.jsx)(d.zG,{})]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"empresa",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{className:"md:col-span-2",children:[(0,n.jsx)(d.lX,{children:"Empresa / Sindicato"}),(0,n.jsx)(d.NI,{children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(v.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),(0,n.jsx)(u.I,{placeholder:"Nombre de la empresa o sindicato",...r,className:"pl-10"})]})}),(0,n.jsx)(d.zG,{})]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"telefono",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[" ",(0,n.jsx)(d.lX,{children:"Tel\xe9fono (Opcional)"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{type:"tel",placeholder:"Tel\xe9fono de contacto",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"email",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{children:[" ",(0,n.jsx)(d.lX,{children:"Email (Opcional)"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{type:"email",placeholder:"Email de contacto",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}}),(0,n.jsx)(d.Wi,{control:_.control,name:"direccion",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.xJ,{className:"md:col-span-2",children:[" ",(0,n.jsx)(d.lX,{children:"Direcci\xf3n (Opcional)"})," ",(0,n.jsx)(d.NI,{children:(0,n.jsx)(u.I,{placeholder:"Direcci\xf3n del adherente",...r})})," ",(0,n.jsx)(d.zG,{})," "]})}})]}),(0,n.jsx)(I.Z,{className:"my-6"}),(0,n.jsx)("h4",{className:"text-md font-semibold mb-3",children:"Documentaci\xf3n del Adherente"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:["fotoDniFrente","fotoDniDorso","fotoPerfil","fotoCarnet"].map(e=>{let r="";switch(e){case"fotoDniFrente":r="DNI Frente";break;case"fotoDniDorso":r="DNI Dorso";break;case"fotoPerfil":r="Foto Perfil";break;case"fotoCarnet":r="Foto Carnet (Opcional)"}let t="fotoPerfil"===e||"fotoCarnet"===e?"Subir foto (PNG, JPG)":"Subir DNI (PNG, JPG, PDF)";return(0,n.jsx)(d.Wi,{control:_.control,name:e,render:a=>{let{field:i}=a,s=i.value,c=(0,o.useMemo)(()=>s instanceof FileList&&s.length>0&&s[0].type.startsWith("image/")?URL.createObjectURL(s[0]):null,[s]),m=(0,o.useMemo)(()=>s instanceof FileList&&s.length>0?s[0].name:null,[s]);return(0,n.jsxs)(d.xJ,{children:[(0,n.jsx)(d.lX,{children:r}),(0,n.jsx)(d.NI,{children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("label",{className:"cursor-pointer w-full min-h-[100px] h-[100px] flex flex-col items-center justify-center p-2 border-2 border-dashed rounded-md hover:border-primary bg-background hover:bg-muted/50 transition-colors",children:[c?(0,n.jsx)(O.default,{src:c,alt:"Vista previa",layout:"fill",objectFit:"contain",className:"rounded-md"}):m?(0,n.jsxs)("div",{className:"text-center p-2 text-muted-foreground",children:[(0,n.jsx)(b.Z,{className:"h-6 w-6 mx-auto mb-1"}),(0,n.jsx)("p",{className:"text-xs break-all",children:m})]}):(0,n.jsxs)("div",{className:"text-center p-2 text-muted-foreground",children:[(0,n.jsx)(y.Z,{className:"h-6 w-6 mx-auto mb-1"}),(0,n.jsx)("p",{className:"text-xs",children:t})]}),(0,n.jsx)(u.I,{type:"file",className:"hidden",onChange:e=>i.onChange(e.target.files&&e.target.files.length>0?e.target.files:null),accept:"fotoPerfil"===e||"fotoCarnet"===e?"image/png,image/jpeg":"image/png,image/jpeg,application/pdf",ref:i.ref,name:i.name,onBlur:i.onBlur})]}),s&&(0,n.jsx)(l.z,{type:"button",variant:"ghost",size:"icon",className:"absolute -top-2 -right-2 h-7 w-7 bg-card rounded-full shadow-md hover:bg-destructive/10",onClick:()=>i.onChange(null),children:(0,n.jsx)(E.Z,{className:"h-4 w-4 text-destructive"})})]})}),(0,n.jsx)(d.zG,{})]})}},e)})}),(0,n.jsxs)(l.z,{type:"submit",className:"mt-6 w-full sm:w-auto",disabled:G,children:[(0,n.jsx)(w.Z,{className:"mr-2 h-4 w-4"})," ",G?"Enviando...":"Enviar Solicitud de Adherente"]})]})}),(0,n.jsx)(I.Z,{className:"my-8"}),(!T.adherentes||0===T.adherentes.length)&&(0,n.jsx)("p",{className:"text-center text-muted-foreground py-6",children:"A\xfan no has propuesto adherentes."}),[{title:"Adherentes Aprobados",adherentes:U(s.rX.APROBADO)},{title:"Adherentes con Solicitud Pendiente",adherentes:U(s.rX.PENDIENTE)},{title:"Adherentes con Solicitud Rechazada",adherentes:U(s.rX.RECHAZADO)},{title:"Adherentes con Eliminaci\xf3n Solicitada",adherentes:V}].map(e=>e.adherentes.length>0&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("h3",{className:"text-xl font-semibold mb-3 text-foreground",children:[e.title," (",e.adherentes.length,")"]}),(0,n.jsx)("div",{className:"space-y-3",children:e.adherentes.map(e=>(0,n.jsx)(c.Zb,{className:"p-4 bg-card shadow-sm",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-semibold text-foreground",children:[e.nombre," ",e.apellido]}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:["DNI: ",e.dni]}),e.telefono&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Tel: ",e.telefono]}),e.email&&(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Email: ",e.email]})]}),(0,n.jsxs)("div",{className:"flex flex-col items-end gap-2 mt-2 sm:mt-0",children:[q(e),e.estadoSolicitud===s.rX.RECHAZADO&&e.motivoRechazo&&(0,n.jsxs)("p",{className:"text-xs text-destructive mt-1",children:["Motivo: ",e.motivoRechazo]}),e.estadoSolicitud===s.rX.APROBADO&&(0,n.jsxs)(l.z,{variant:"outline",size:"sm",className:"mt-1 text-xs",onClick:()=>J(e.id),children:[(0,n.jsx)(E.Z,{className:"mr-1.5 h-3.5 w-3.5"})," Solicitar Eliminaci\xf3n"]})]})]})},e.id))})]},e.title))]})]})})}},79055:function(e,r,t){"use strict";t.d(r,{C:function(){return s}});var n=t(57437);t(2265);var o=t(13027),a=t(49354);let i=(0,o.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function s(e){let{className:r,variant:t,...o}=e;return(0,n.jsx)("div",{className:(0,a.cn)(i({variant:t}),r),...o})}},29973:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});var n=t(57437),o=t(2265),a=t(48484),i=t(49354);let s=o.forwardRef((e,r)=>{let{className:t,orientation:o="horizontal",decorative:s=!0,...l}=e;return(0,n.jsx)(a.f,{ref:r,decorative:s,orientation:o,className:(0,i.cn)("shrink-0 bg-border","horizontal"===o?"h-[1px] w-full":"h-full w-[1px]",t),...l})});s.displayName=a.f.displayName},39630:function(e,r,t){"use strict";t.d(r,{H:function(){return u},V:function(){return d}});var n=t(57437),o=t(2265),a=t(75735),i=t(25419),s=t(26912),l=t(94282),c=t(86763);let d=(0,o.createContext)(void 0),u=e=>{let{children:r}=e,[t,u]=(0,o.useState)(null),[m,h]=(0,o.useState)(null),[x,f]=(0,o.useState)(null),[p,j]=(0,o.useState)(null),[g,N]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=()=>{};return i.I8&&(e=(0,a.Aj)(i.I8,async e=>{if(N(!0),e){u(e),console.log("Firebase Auth UID for logged-in user:",e.uid);try{let r=await (0,s.AZ)(e.uid);if(r)h(r.role),f("".concat(r.nombre," ").concat(r.apellido)),j(r.numeroSocio);else{let r=await (0,s.Xt)(e.uid);r?(h(r.role),f(r.name)):(console.warn("User with UID ".concat(e.uid," and email ").concat(e.email," is authenticated but has no profile in 'socios' or 'adminUsers' collections. Assign a role in Firestore to grant access.")),h(null),f(e.displayName||e.email)),j(null)}}catch(r){console.error("AuthContext: Failed to fetch user profile from Firestore.",r),(0,c.Am)({title:"Error de Permisos o Conexi\xf3n",description:"No se pudo cargar tu perfil. Esto puede deberse a un problema de conexi\xf3n o a que las reglas de seguridad de Firestore no permiten el acceso. Contacte al administrador.",variant:"destructive",duration:1e4}),h(null),f(e.displayName||e.email),j(null)}}else u(null),h(null),f(null),j(null);N(!1)})),()=>e()},[]);let v=async()=>{await (0,l.TX)()};return(0,n.jsx)(d.Provider,{value:{isLoggedIn:!!t,user:t,userRole:m,userName:x,loggedInUserNumeroSocio:p,isLoading:g,logout:v},children:r})}},67048:function(e,r,t){"use strict";t.d(r,{a:function(){return a}});var n=t(2265),o=t(39630);let a=()=>{let e=(0,n.useContext)(o.V);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},94282:function(e,r,t){"use strict";t.d(r,{EL:function(){return l},TX:function(){return c},pH:function(){return s}});var n=t(75735),o=t(25419),a=t(86763),i=t(26912);let s=async(e,r)=>{try{if(!o.I8)throw Error("Auth service not initialized.");return(await (0,n.e5)(o.I8,e,r)).user}catch(e){return console.error("Firebase login error:",e),(0,a.Am)({title:"Error de Inicio de Sesi\xf3n",description:"Email o contrase\xf1a incorrectos. Por favor, intente de nuevo.",variant:"destructive"}),null}},l=async e=>{try{if(!o.I8)throw Error("Auth service not initialized.");let r=(await (0,n.Xb)(o.I8,e.email,e.password)).user;await (0,n.ck)(r,{displayName:"".concat(e.nombre," ").concat(e.apellido)});let t=async(e,t)=>e instanceof FileList&&e.length>0?(0,i.cT)(e[0],"socios/".concat(r.uid,"/").concat(t)):null,[a,s,l,c]=await Promise.all([t(e.fotoPerfil,"fotoPerfil.jpg"),t(e.fotoDniFrente,"fotoDniFrente.jpg"),t(e.fotoDniDorso,"fotoDniDorso.jpg"),t(e.fotoCarnet,"fotoCarnet.jpg")]),d={email:e.email,nombre:e.nombre,apellido:e.apellido,fechaNacimiento:e.fechaNacimiento,dni:e.dni,empresa:e.empresa,telefono:e.telefono,direccion:e.direccion,fotoUrl:a,fotoPerfil:a,fotoDniFrente:s,fotoDniDorso:l,fotoCarnet:c,grupoFamiliar:[]};return await (0,i.l1)(r.uid,d,!0),r}catch(r){console.error("Firebase signup error:",r);let e="Ocurri\xf3 un error inesperado al crear la cuenta.";return"auth/email-already-in-use"===r.code&&(e="El email ingresado ya est\xe1 en uso. Por favor, utilice otro."),(0,a.Am)({title:"Error de Registro",description:e,variant:"destructive"}),null}},c=async()=>{try{if(!o.I8)throw Error("Auth service not initialized.");await (0,n.w7)(o.I8)}catch(e){console.error("Error signing out:",e),(0,a.Am)({title:"Error",description:"No se pudo cerrar la sesi\xf3n.",variant:"destructive"})}}}},function(e){e.O(0,[4358,139,4868,317,9772,3906,8173,8384,932,342,6068,7108,2971,7023,1744],function(){return e(e.s=43882)}),_N_E=e.O()}]);